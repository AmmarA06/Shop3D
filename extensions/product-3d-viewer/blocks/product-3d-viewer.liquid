{% comment %}
  3D Product Viewer Block
  Centralized viewer for browsing products in 3D
{% endcomment %}

{{ 'product-3d-viewer.css' | asset_url | stylesheet_tag }}

<div
  class="product-3d-viewer"
  data-shop-domain="{{ shop.permanent_domain }}"
  data-api-url="{{ shop.url }}"
  {{ block.shopify_attributes }}
>
  <div class="product-3d-viewer__layout">
    <!-- Main Viewer -->
    <div class="product-3d-viewer__main">
      <div class="product-3d-viewer__container">
    {%- if block.settings.show_header -%}
      <div class="product-3d-viewer__header">
        <h3 class="product-3d-viewer__title">
          {{ block.settings.heading | default: "View in 3D" }}
        </h3>
      </div>
    {%- endif -%}

    <!-- Loading state -->
    <div class="product-3d-viewer__loading" data-loading>
      <div class="product-3d-viewer__spinner"></div>
      <p>{{ block.settings.loading_text | default: "Loading 3D model..." }}</p>
    </div>

    <!-- Error state -->
    <div class="product-3d-viewer__error" data-error style="display: none;">
      <p>{{ block.settings.error_text | default: "3D model not available for this product" }}</p>
    </div>

    <!-- 3D viewer canvas container -->
    <div class="product-3d-viewer__canvas" data-canvas style="display: none;">
      <!-- Three.js will render here -->
    </div>

    {%- if block.settings.show_instructions -%}
      <div class="product-3d-viewer__instructions">
        <p>{{ block.settings.instructions_text | default: "Click and drag to rotate • Scroll to zoom • Right-click to pan" }}</p>
      </div>
    {%- endif -%}
      </div>
    </div>

    <!-- Sidebar -->
    <div class="product-3d-viewer__sidebar">
      <!-- Product Selector -->
      <div class="product-3d-viewer__card">
        <div class="product-3d-viewer__card-header">
          <h4 class="product-3d-viewer__card-title">Select Product</h4>
        </div>
        <div class="product-3d-viewer__card-body">
          <div class="product-3d-viewer__product-list" data-product-list>
            <!-- Products will be loaded dynamically via JavaScript -->
            <div style="text-align: center; padding: 1rem; color: #666;">
              Loading products...
            </div>
          </div>
        </div>
      </div>

      <!-- Controls -->
      <div class="product-3d-viewer__card">
        <div class="product-3d-viewer__card-header">
          <h4 class="product-3d-viewer__card-title">Controls</h4>
        </div>
        <div class="product-3d-viewer__card-body">
          <div class="product-3d-viewer__control-list">
            <button
              type="button"
              class="product-3d-viewer__control-list-btn"
              data-control="auto-rotate"
              aria-label="Toggle auto-rotate"
            >
              <span data-rotate-text>Start Auto-Rotate</span>
            </button>
            <button
              type="button"
              class="product-3d-viewer__control-list-btn"
              data-control="grid"
              aria-label="Toggle grid"
            >
              <span data-grid-text>Hide Grid</span>
            </button>
            <button
              type="button"
              class="product-3d-viewer__control-list-btn"
              data-control="reset"
              aria-label="Reset camera"
            >
              Reset Camera
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.152.2/examples/jsm/"
    }
  }
</script>
<script type="module" src="{{ 'product-3d-viewer.js' | asset_url }}"></script>

{% schema %}
{
  "name": "3D Product Viewer",
  "target": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_header",
      "label": "Show header",
      "default": true
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "View in 3D"
    },
    {
      "type": "checkbox",
      "id": "show_instructions",
      "label": "Show instructions",
      "default": true
    },
    {
      "type": "text",
      "id": "instructions_text",
      "label": "Instructions text",
      "default": "Click and drag to rotate • Scroll to zoom • Right-click to pan"
    },
    {
      "type": "text",
      "id": "loading_text",
      "label": "Loading text",
      "default": "Loading 3D model..."
    },
    {
      "type": "text",
      "id": "error_text",
      "label": "Error text",
      "default": "3D model not available for this product"
    },
    {
      "type": "range",
      "id": "viewer_height",
      "min": 300,
      "max": 800,
      "step": 50,
      "unit": "px",
      "label": "Viewer height",
      "default": 500
    },
    {
      "type": "checkbox",
      "id": "auto_rotate",
      "label": "Auto-rotate by default",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_grid",
      "label": "Show grid",
      "default": true
    }
  ]
}
{% endschema %}
